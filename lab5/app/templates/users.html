{% extends 'base.html' %}
{% block content %}
<h1>Список пользователей</h1>

<table class="table table-bordered align-middle">
  <thead>
    <tr>
      <th style="width: 80px;">№</th>
      <th>ФИО</th>
      <th style="width: 220px;">Роль</th>
      <th style="width: 340px;">Действия</th>
    </tr>
  </thead>
  <tbody>
    {% for u in users %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ u.fio }}</td>
        <td>{{ u.role_name if u.role_name else "—" }}</td>
        <td>
          {% if current_user.is_authenticated and can_view_user(u.id) %}
            <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('user_view', user_id=u.id) }}">Просмотр</a>
          {% endif %}

          {% if current_user.is_authenticated and can_edit_user(u.id) %}
            <a class="btn btn-sm btn-outline-primary" href="{{ url_for('user_edit', user_id=u.id) }}">Редактирование</a>
          {% endif %}

          {% if current_user.is_authenticated and can_delete_user() %}
            <form method="post" action="{{ url_for('user_delete', user_id=u.id) }}" style="display:inline-block;">
              <button class="btn btn-sm btn-outline-danger" type="submit">Удаление</button>
            </form>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% if current_user.is_authenticated and has_right('users.create') %}
  <a class="btn btn-primary" href="{{ url_for('user_create') }}">Создание пользователя</a>
{% endif %}

{% endblock %}